(this["webpackJsonpONE-dbc"]=this["webpackJsonpONE-dbc"]||[]).push([[52],{1286:function(e,t,a){"use strict";a.r(t);var n=a(8),c=a(6),r=a(3),s=a(2),l=a.n(s),i=a(0),o=a(188),u=a(322),b=a(189),j=a(35),d=a(53),O=a(127),m=a(91),f=a(1183),p=a(23),g=a(160),x=a(62),h=a(17),v=a(19),k=a(143),S=a(39),C=a(18),w=a(20),N=a(29),y=a(138),R=a(27),T=a(32),P=a(1),L={3:180,6:90,8:-90},B=function(e){var t=e.closeDialog,a=e.dialogOpen,s=e.onSetNotification,B=e.userId,I=Object(y.a)(),V=Object(R.b)(),A=Object(T.a)(),D=Object(N.b)(),E=Object(w.b)().languageVars.pages.editProfile,U=Object(i.useState)(!1),M=Object(r.a)(U,2),F=M[0],W=M[1],z=Object(i.useState)(!1),Z=Object(r.a)(z,2),J=Z[0],q=Z[1],H=Object(i.useState)(!1),_=Object(r.a)(H,2),G=_[0],K=_[1],Q=Object(i.useState)("Loading"),X=Object(r.a)(Q,2),Y=X[0],$=X[1],ee=Object(i.useState)(!1),te=Object(r.a)(ee,2),ae=te[0],ne=te[1],ce=Object(i.useState)(null),re=Object(r.a)(ce,2),se=re[0],le=re[1],ie=Object(i.useState)(null),oe=Object(r.a)(ie,2),ue=oe[0],be=oe[1],je=Object(i.useState)(null),de=Object(r.a)(je,2),Oe=de[0],me=de[1],fe=Object(i.useState)(null),pe=Object(r.a)(fe,2),ge=pe[0],xe=pe[1],he=Object(i.useState)({x:0,y:0}),ve=Object(r.a)(he,2),ke=ve[0],Se=ve[1],Ce=Object(i.useState)(0),we=Object(r.a)(Ce,2),Ne=we[0],ye=we[1],Re=Object(i.useState)(1),Te=Object(r.a)(Re,2),Pe=Te[0],Le=Te[1],Be=Object(i.useState)(null),Ie=Object(r.a)(Be,2),Ve=Ie[0],Ae=Ie[1],De=Object(i.useState)(!1),Ee=Object(r.a)(De,2),Ue=Ee[0],Me=Ee[1],Fe=Object(i.useState)(!1),We=Object(r.a)(Fe,2),ze=We[0],Ze=We[1],Je=Object(i.useState)(null),qe=Object(r.a)(Je,2),He=qe[0],_e=qe[1],Ge={image:Object(h.b)("imageUpload",E.forms.pictureTab.image,{name:"image",placeholder:E.forms.pictureTab.image,stateClass:"cropActive",withView:!1,showLabel:!1,label:null,selectButtonText:"Upload image",changeButtonText:"Change"},"",null,{required:!1},!1,{xs:12,sm:null,md:null,lg:null,xl:null,fullWidth:!0})},Ke=Object(i.useState)(Object(c.a)({},Ge)),Qe=Object(r.a)(Ke,2),Xe=Qe[0],Ye=Qe[1];Object(i.useEffect)((function(){var e=!0;return e&&B&&Object(n.a)(l.a.mark((function e(){var t,a,n;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,K(!0),e.next=4,Object(S.k)(B);case 4:if(t=e.sent,_e(t),!t.image){e.next=11;break}return e.next=9,Object(C.c)().ref("profiles/".concat(t.image)).getDownloadURL();case 9:a=e.sent,me(a);case 11:n=Object(h.a)(Xe,t,null),Ye((function(e){return Object(c.a)(Object(c.a)({},e),n.adjustedForm)})),W(n.formValid),K(!1),e.next=20;break;case 17:throw e.prev=17,e.t0=e.catch(0),new Error(e.t0);case 20:case"end":return e.stop()}}),e,null,[[0,17]])})))(),function(){e=!1}}),[B]);var $e,et=Object(i.useCallback)((function(e,t){Ae(t)}),[]),tt=function(e){return new Promise((function(t){var a=new FileReader;a.addEventListener("load",(function(){return t(a.result)}),!1),a.readAsDataURL(e)}))},at=function(){var e=Object(n.a)(l.a.mark((function e(t,a){var n,c,r,s,i,u,j,d;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(t&&t[0]instanceof File)){e.next=26;break}return n=t[0],c={maxSizeMB:n.size>8e6?.05:2,maxWidthOrHeight:550,useWebWorker:!0},e.next=5,Object(o.a)(n,c);case 5:return r=e.sent,s=Object(v.o)(r,+new Date),le(s),e.next=10,tt(s);case 10:return i=e.sent,e.next=13,Object(b.getOrientation)(s);case 13:if(u=e.sent,!(j=L[u])){e.next=19;break}return e.next=18,Object(k.b)(i,j);case 18:i=e.sent;case 19:be(s.type),xe(i),d=Object(h.a)(Xe,s.name,a),Ye(d.adjustedForm),W(d.formValid),q(!0),ne(!1);case 26:case"end":return e.stop()}}),e)})));return function(t,a){return e.apply(this,arguments)}}(),nt=function(){Ye(Ge),le(null),be(null),me(null),xe(null),Se({x:0,y:0}),ye(0),Le(1),Ze(!1),Me(!1),t()},ct=function(){var e=Object(n.a)(l.a.mark((function e(t){var a,n,r;return l.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.preventDefault(),K(!0),a=Object(h.c)(Xe),n=Object(c.a)(Object(c.a)({},He),a),e.prev=4,!se){e.next=21;break}return Me(!0),$(E.messages.loading.uploadingNewImage),e.next=10,Object(k.a)(ge,Ve,Ne,ue);case 10:if(r=e.sent,!He.image){e.next=14;break}return e.next=14,Object(C.c)().ref().child("/profiles/".concat(He.image)).delete();case 14:return e.next=16,Object(C.c)().ref("/profiles/".concat(se.name)).putString(r,"data_url");case 16:n.image=se.name,le(null),Ze(!1),e.next=29;break;case 21:if(!ze){e.next=29;break}if(Me(!0),$(E.messages.loading.removingImage),!He.image){e.next=27;break}return e.next=27,Object(C.c)().ref().child("/profiles/".concat(He.image)).delete();case 27:n.image=null,le(null);case 29:return $(E.messages.loading.updatingVcard),e.next=32,Object(S.u)(B,n);case 32:ne(!0),q(!1),K(!1),s({message:E.messages.notifications.profileInfoUpdateSuccess,type:"success"}),nt(),e.next=43;break;case 39:e.prev=39,e.t0=e.catch(4),K(!1),s({message:E.messages.notifications.profileInfoUpdateError,type:"error"});case 43:case"end":return e.stop()}}),e,null,[[4,39]])})));return function(t){return e.apply(this,arguments)}}(),rt=ae||J&&!F||!J||G;return Object(P.jsx)(g.a,{open:a,onClose:nt,title:"".concat(He&&He.firstName?He.firstName:""," ").concat(He&&He.lastName?He.lastName:""," Picture"),loading:!1,actionButtonOne:Object(P.jsx)(m.a,{color:"secondary",onClick:function(e){return ct(e)},disabled:rt,className:A.defaultButton,style:{backgroundColor:!rt&&D},children:E.buttons.updatePicture}),children:Object(P.jsx)(j.a,{children:G?Object(P.jsx)(p.a,{loadingText:"".concat(J?Y:E.messages.loading.loadingProfileInfo)}):Object(P.jsx)(j.a,{children:Object(P.jsx)(j.a,{className:I.root,children:Object(P.jsx)(O.a,{container:!0,spacing:3,children:Object(P.jsx)(O.a,{item:!0,xs:12,children:Object(P.jsxs)(j.a,{className:"".concat(V.panel," ").concat(He&&He.image&&!se?I.logoPanel:""),children:[He&&He.image&&!se&&!Ue&&!ze&&Object(P.jsx)(j.a,{className:I.currenPictureContainerSm,children:Object(P.jsx)("img",{src:Oe,alt:"Profile"})}),(se||Ue&&!ze)&&Object(P.jsxs)(j.a,{className:I.cropper,children:[Object(P.jsx)(j.a,{className:"".concat(I.cropContainer),children:Object(P.jsx)(u.a,{image:ge,crop:ke,zoom:Pe,rotation:Ne,aspect:2,onCropChange:Se,onCropComplete:et,onZoomChange:Le,onRotationChange:ye})}),!G&&Object(P.jsxs)(j.a,{className:I.controls,children:[Object(P.jsxs)(j.a,{className:I.sliderContainer,children:[Object(P.jsx)(d.a,{variant:"overline",classes:{root:I.sliderLabel},children:"Zoom"}),Object(P.jsx)(f.a,{value:Pe,min:1,max:3,step:.1,"aria-labelledby":"Zoom",onChange:function(e,t){return Le(t)},classes:{root:I.sliderRoot,thumb:I.sliderThumb,track:I.sliderTrack,rail:I.sliderRail,mark:I.sliderMark,markActive:I.markActive}})]}),Object(P.jsxs)(j.a,{className:I.sliderContainer,children:[Object(P.jsx)(d.a,{variant:"overline",classes:{root:I.sliderLabel},children:"Rotate"}),Object(P.jsx)(f.a,{value:Ne,min:0,max:360,step:1,"aria-labelledby":"Rotation",classes:{root:I.sliderRoot,thumb:I.sliderThumb,track:I.sliderTrack,rail:I.sliderRail,mark:I.sliderMark,markActive:I.markActive},onChange:function(e,t){return ye(t)}})]})]})]}),($e=Xe,Object.keys($e).map((function(e,t){return Object(P.jsx)(x.a,{elementType:$e[e].elementType,label:$e[e].elementLabel,value:$e[e].value,elementOptions:$e[e].elementOptions,touched:$e[e].touched,valid:$e[e].isValid,errorMessage:$e[e].errorMessage,shouldValidate:$e[e].validtationRules,elementSetup:$e[e].elementSetup,changed:function(t){return at(t,e)},grid:$e[e].grid,disabled:G},e+t)}))),(He&&He.image&&!ze||se)&&Object(P.jsx)(m.a,{onClick:function(e){return function(e){e.preventDefault(),Ye(Ge),me(null),le(null),Ze(!0),q(!0),ne(!1)}(e)},className:"".concat(A.defaultButton," ").concat(V.panelButton),style:{backgroundColor:D.color.code},children:E.buttons.removePicture})]})})})})})})})};B.defaultProps={dialogOpen:!1,userId:null},t.default=B}}]);